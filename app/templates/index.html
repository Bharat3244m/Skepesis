{% extends "base.html" %}

{% block title %}Skepesis ‚Äî Master Knowledge Through Curiosity{% endblock %}

{% block content %}
<!-- Hero Section -->
<div class="hero">
    <div class="container">
        <div class="hero-content">
            <h1 class="hero-title">
                Master Knowledge<br>
                Through Curiosity
            </h1>
            <p class="hero-subtitle">
                Adaptive learning platform that analyzes your confidence patterns,
                identifies knowledge gaps, and provides personalized insights to accelerate your growth.
            </p>
            <div class="hero-cta">
                <button class="btn-primary btn-large" onclick="showStartModal()">
                    Start Learning
                </button>
                <a href="/dashboard" class="btn-secondary btn-large">
                    View History
                </a>
            </div>
        </div>
    </div>
</div>

<!-- Core Capabilities -->
<section class="features">
    <div class="container">
        <div class="features-header">
            <h2 class="section-title">How It Works</h2>
        </div>
        
        <div class="features-grid">
            <div class="feature-card">
                <div class="feature-icon">üìù</div>
                <h3 class="feature-title">Answer & Rate Confidence</h3>
                <p class="feature-description">
                    Take a quiz on any topic. After each answer, rate how confident you feel‚Äîthis builds metacognitive awareness.
                </p>
            </div>
            
            <div class="feature-card">
                <div class="feature-icon">üî¨</div>
                <h3 class="feature-title">AI-Powered Analysis</h3>
                <p class="feature-description">
                    Receive a detailed cognitive report analyzing your response patterns, confidence calibration, and knowledge gaps.
                </p>
            </div>
            
            <div class="feature-card">
                <div class="feature-icon">üí¨</div>
                <h3 class="feature-title">Explore with Curiosity Solver</h3>
                <p class="feature-description">
                    Ask follow-up questions and get analytical explanations to deepen your understanding of any topic.
                </p>
            </div>
        </div>
    </div>
</section>

<!-- CTA Section -->
<section class="cta-section">
    <div class="container">
        <div class="cta-card">
            <h2 class="cta-title">Ready to start?</h2>
            <button class="btn-primary btn-large" onclick="showStartModal()">
                Begin Session
            </button>
        </div>
    </div>
</section>

<!-- Start Modal -->
<div id="startModal" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <h2 class="modal-title">Begin Learning Session</h2>
            <button class="modal-close" onclick="hideStartModal()">&times;</button>
        </div>
        <div class="modal-body">
            <form id="startForm" onsubmit="startQuiz(event)">
                <div class="form-group">
                    <label class="form-label">Your Name</label>
                    <input 
                        type="text" 
                        id="studentName" 
                        class="form-input" 
                        placeholder="Enter your name"
                        required
                    >
                </div>
                
                <div class="form-group">
                    <label class="form-label">Category (Optional)</label>
                    <select id="category" class="form-input">
                        <option value="">Any Category</option>
                        <!-- Categories will be loaded dynamically -->
                    </select>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Number of Questions</label>
                    <input 
                        type="number" 
                        id="questionCount" 
                        class="form-input" 
                        value="10" 
                        min="5" 
                        max="20"
                    >
                </div>
                
                <button type="submit" class="btn-primary btn-block">
                    Start Session
                </button>
            </form>
        </div>
    </div>
</div>

<script>
// Load categories on page load
document.addEventListener('DOMContentLoaded', loadCategories);

async function loadCategories() {
    try {
        const response = await fetch('/api/questions/categories');
        const categories = await response.json();
        
        const select = document.getElementById('category');
        categories.forEach(cat => {
            const option = document.createElement('option');
            option.value = cat;
            option.textContent = cat;
            select.appendChild(option);
        });
    } catch (error) {
        console.error('Error loading categories:', error);
    }
}

function showStartModal() {
    document.getElementById('startModal').classList.add('active');
}

function hideStartModal() {
    document.getElementById('startModal').classList.remove('active');
}

async function startQuiz(event) {
    event.preventDefault();
    
    const studentName = document.getElementById('studentName').value;
    const category = document.getElementById('category').value;
    const questionCount = document.getElementById('questionCount').value;
    
    try {
        // Create attempt
        const response = await fetch('/api/attempts/', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({ student_name: studentName })
        });
        
        const attempt = await response.json();
        
        // Redirect to quiz with parameters
        window.location.href = `/quiz?attempt_id=${attempt.id}&count=${questionCount}&category=${category}`;
    } catch (error) {
        console.error('Error starting quiz:', error);
        alert('Failed to start quiz. Please try again.');
    }
}

// Close modal on outside click
window.onclick = function(event) {
    const modal = document.getElementById('startModal');
    if (event.target === modal) {
        hideStartModal();
    }
}
</script>
{% endblock %}
